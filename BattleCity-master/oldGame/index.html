<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="user-scalable=0">
	<title>Битва танков</title>
	<style media="screen">
		#audio-init {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0,0,0,0.95);
			z-index: 9999;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		
		#audio-init button {
			padding: 20px 40px;
			font-size: 24px;
			background: #4CAF50;
			border: none;
			border-radius: 5px;
			color: white;
			cursor: pointer;
		}
		body {
			margin: 0;
			color: #87968e;
			background-color: #660;
			font-family: "Helvetica Neue",Helvetica,Arial,'Microsoft YaHei',sans-serif,'Lato', Calibri;
		}
		@font-face {
			font-family: prstart;
			src: url('font/prstart.ttf');
		}
		.game {
			position: relative;
			margin: 100px auto;
			width: 530px;
			height: 470px;
		}
		#text {
			position: absolute;
			left: -200px;
			height: 456px;
			width: 200px;
		}
		#text p {
			font-size: 1.17em;
			font-weight: bold;
			padding-top: 150px;
		}
		#game-box-border {
			position: absolute;
			width: 516px;
			height: 456px;
			background-color: #000;
			border: #630 solid 4px;
		}
		#game-box {
			position: absolute;
			top: 20px;
			left: 35px;
			width: 416px;
			height: 416px;
			background-color: #000;
		}
		#canvas-bg,
		#canvas-misc {
			position: absolute;
			top: 0;
			left: 0;
		}
		#canvas-misc {
			z-index: 2;
		}
		#canvas-role {
			position: absolute;
			top: 20px;
			left: 35px;
		}
		.hide {
			display: none;
		}

		/* Мобильные устройства */
		@media screen and (min-width: 1000px) {
			#key {
				display: none;
			}
		}
		/* Кнопки управления */
		#key {
			position: absolute;
			top: 800px;
			left: 50%;
			margin-left: -400px;
			width: 800px;
			height: 0;
		}
		#key button {
			position: absolute;
			width: 150px;
			height: 150px;
			border-radius: 30px;
			outline:none;
			color: #87968e;
			font-size: 40px;
		}
		.btn_u {
			top: 0;
			left: 200px;
		}
		.btn_r {
			top: 200px;
			left: 400px;
		}
		.btn_d {
			top: 200px;
			left: 200px;
		}
		.btn_l {
			top: 200px;
			left: 0;
		}
		.btn_a {
			top: 0;
			right: 0;
		}
		.btn_b {
			top: 250px;
			right: 0;
		}
	</style>
</head>
<body onselectstart="return false">
	<div id="audio-init">
		<button onclick="initAudio()">ВКЛЮЧИТЬ ЗВУК И НАЧАТЬ ИГРУ</button>
	</div>
	<div class="game">
		<div id="text">
			<p>
				Управление: W A S D <br><br>
				Кнопки A/B: H J <br><br>
				Доступны одиночный режим и режим редактора карт
			</p>
		</div>
		<div id="game-box-border">
			<div id="game-box"></div>
			<!-- Слой с персонажами -->
			<canvas id="canvas-role" width="416" height="416"></canvas>
			<!-- Фоновый слой -->
			<canvas id="canvas-bg" width="516" height="456"></canvas>
			<!-- Слой эффектов -->
			<canvas id="canvas-misc" width="516" height="456"></canvas>
		</div>
	</div>
	<div id="key">
		<button type="button" value="87" class="btn_u">Вверх</button>
		<button type="button" value="68" class="btn_r">Вправо</button>
		<button type="button" value="83" class="btn_d">Вниз</button>
		<button type="button" value="65" class="btn_l">Влево</button>
		<button type="button" value="74" class="btn_a">A</button>
		<button type="button" value="72" class="btn_b">B</button>
	</div>
	<!-- Прелоад изображений -->
	<div class="hide">
		<img src="src/image/UI.png" id="UI">
		<img src="src/image/myTank.png" id="myTank">
		<img src="src/image/enemyTank.png" id="enemyTank">
		<img src="src/image/bonus.png" id="bonus">
		<img src="src/image/Misc.png" id="Misc">
		<img src="src/image/brick.png" id="brick">
		<img src="src/image/Boom.png" id="boom">
		<img src="src/image/getScore.png" id="getScore">
	</div>
	<!-- Прелоад аудио -->
	<div class="hide">
		<audio src="src/sound/bonus/life.mp3" id="life"></audio>
		<audio src="src/sound/bonus/bomb.mp3" id="bomb"></audio>
		<audio src="src/sound/bonus/misc.mp3" id="miscSound"></audio>
		<audio src="src/sound/attack.mp3" id="attack"></audio>
		<audio src="src/sound/explode.mp3" id="explode"></audio>
		<audio src="src/sound/attackOver.mp3" id="attackOver"></audio>
		<audio src="src/sound/pause.mp3" id="pause"></audio>
		<audio src="src/sound/eat.mp3" id="eat"></audio>
		<audio src="src/sound/over.mp3" id="over"></audio>
		<audio src="src/sound/start.mp3" id="start"></audio>
	</div>

	<!-- Скрипты -->
	<script>
		// Глобальные переменные для управления звуком
		let audioContext;
		let soundEnabled = false;

		// Функция инициализации аудио
		function initAudio() {
			document.getElementById('audio-init').style.display = 'none';
			
			try {
				// Создаем аудио контекст
				audioContext = new (window.AudioContext || window.webkitAudioContext)();
				
				// Загружаем и воспроизводим тестовый звук
				const testSound = document.getElementById('start');
				testSound.play()
					.then(() => {
						testSound.pause();
						testSound.currentTime = 0;
						soundEnabled = true;
						startGame();
					})
					.catch(e => console.error('Ошибка инициализации:', e));
			} catch(e) {
				console.error('Web Audio API не поддерживается:', e);
				alert('Ваш браузер не поддерживает аудио!');
			}
		}

		// Модифицированная функция воспроизведения звука
		function playSound(id) {
			if (!soundEnabled) return;
			
			const audio = document.getElementById(id);
			if (!audio) return;

			try {
				audio.currentTime = 0;
				audio.play().catch(e => console.warn('Ошибка воспроизведения:', id, e));
			} catch(e) {
				console.error('Ошибка звука:', e);
			}
		}

		// Модифицированная функция запуска игры
		function startGame() {
			// Инициализация остальных компонентов игры
			if (typeof init === 'function') {
				init();
			}
			if (typeof gameLoop === 'function') {
				gameLoop();
			}
		}
	</script>
	<script type="text/javascript" src='src/comm.js'></script>
	<script type="text/javascript" src='src/keyboard/key.js'></script>
	<script type="text/javascript" src='src/object/explode.js'></script>
	<script type="text/javascript" src='src/object/bonus.js'></script>
	<script type="text/javascript" src='src/object/mover.js'></script>
	<script type="text/javascript" src='src/object/bullet.js'></script>
	<script type="text/javascript" src='src/object/tank.js'></script>
	<script type="text/javascript" src='src/object/player.js'></script>
	<script type="text/javascript" src='src/object/enemyTank.js'></script>
	<script type="text/javascript" src='src/UI/UI.js'></script>
	<script type="text/javascript" src='src/gameMap/drawMap.js'></script>
	<script type="text/javascript" src='src/gameMap/mapEditor.js'></script>
	<script type="text/javascript" src='src/gameMap/mapData.js'></script>
	<script type="text/javascript" src='src/gameMap/misc.js'></script>
	<script type="text/javascript" src='src/gameLoader.js'></script>
</body>
</html>
